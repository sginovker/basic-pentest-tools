import os
from winreg import *


# system id to username
def sidToUser(sid):
    try:
        key = OpenKey(HKEY_LOCAL_MACHINE,
        "SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList"+ "\\" + sid)
        (value, type) = QueryValueEx(key, "ProfileImage")
        user = value.split("\\")[-1]
        return user
    except:
        return sid


# return recycle directory path based on OS
def returnDir():
    # check norton, old windows, and new windows recycle paths
    dirs = ["C:\\Recycler\\", "C:\\Recycled\\", "C:\\$Recycle.Bin\\"]
    for recycleDir in dirs:
        if os.path.isdir(recycleDir):
            return recycleDir
    return None


# loop over files found in recycle directory and print
def findRecycled(recycleDir):
    dirList = os.listdir(recycleDir)
    for sid in dirList:
        files = os.listdir(recycleDir + sid)
        user = sidToUser(sid)
        print("\n[*] Listing Files For User: " + str(user))
        for file in files:
            print("[+] Found File: " + str(file))


# find any recycled files on windows os
if __name__ == "__main__":
    recycledDir = returnDir()
    findRecycled(recycledDir)
